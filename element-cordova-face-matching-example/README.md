![element](https://github.com/Element1/element-android-examples/raw/master/element-cordova-face-matching-example/images/element.png "element")
# Cordova Element Face Matching SDK
The Element Face Matching SDK is an API library to match a face with pre-provided "selfie" (profile) image. This document contains information to integrate the Element Face SDK into an Cordova Android application. This example **will not** run out of the box, it contains only the basic code required to demonstrate how a Cordova App can be made -- the rest is generated by Cordova. Creating a working Cordova App from scratch is not in the scope of this README. [Read about that here.](https://cordova.apache.org/docs/en/latest/guide/cli/index.html)

## Version Support
- The Element Face Matching SDK supports Android 5.0+ / API 21+ (Lollipop and up)
- Android Studio 3.1.3 with Gradle 4.4
- Last Target SDK Version: 27
- Last Compiled Support Library Version: 27.1.0
- Last Compiled Google Play Services Version: 15.0.1
- AWS Mobile SDK: 2.6.+
- Google Guava for Android: 23.5

## Prerequisites
### Element Dashboard
The Element Dashboard is the gateway to the assets in order to use the Element Face Matching SDK. The URL of the Element Dashboard varies based on your region. Also an account is required to access the Element Dashboard. Please contact [Element](https://github.com/Element1/element-android-examples/blob/master/element-cordova-face-sdk-example/README.md#questions) for more information.

### Cordova Face Matching SDK Plugin
The Cordova Element Face Matching SDK has been package as a [Cordova Andriod Plugin](https://cordova.apache.org/docs/en/latest/)! 
Download the Plugin:
1. Log into the Element Dashboard with your account.
1. Select `Setting` tab in the left navigation bar.
1. Find the menu item named `SDK`, click the `View` button next to it.
![dashboard-account](https://github.com/Element1/element-android-examples/raw/master/element-cordova-face-matching-example/images/settingsScreen.jpg "settingsScreen")
1. Under `SDK Files` section, click the SDK download link and save it to the desktop of your computer.
![dashboard-sdk-files](https://github.com/Element1/element-android-examples/raw/master/element-cordova-face-matching-example/images/downloadSdk.jpg "downloadSdk")


## Setup with Cordova

### Import the Plugin
Once you have a basic Cordova project created, the following steps are done from your projects root directory.
1. Run ```cordova platform add android``` to add latest Android support to your project.
2. Run ```cordova plugin add <path to Face Matching SDK Plugin>```. This will create a symbolic link in your project including the Face SDK AAR and a plugin entry in *config.xml*.
```
<plugin name="element-face-sdk" spec="/path/to/element-face-matching-sdk/plugin" /> 
```   
3. The SDK requires a minimum Android SDK version of 21, as enforced in the *config.xml*. Make sure there is a "preference" in your Android specific platform tag enforcing this. If this doesn't update the "defaultMinSdkVersion" in projects build.gradle, then just update it manually.

4. You also need to inject the following strings in the same place, as shown. Please speak with your Element contact for details.

```
<platform name="android">
    <preference name="android-minSdkVersion" value="21" />
    <config-file mode="merge" parent="/*" target="res/values/strings.xml">
        <string name="fm_url">INSERT_URL</string>
        <string name="api_key">INSERT_KEY</string>
    </config-file>
</platform>
```    

### Import the AAR
1. Open your project in Android Studio. It's in the **/platforms/android** of your Cordova project.
1. On the top menu bar, click `File -> New -> New Module`. In the `Create New Module` window, click `Import .JAR/.AAR Package`, then click `Next`.
1. In the next window, click the `...` next to `File name` field and select the AAR file that has been copied in by our Plugin into the Android **src/libs** folder. Then type in `element-face-matching-sdk` in the `Subproject Name` field.
1. Click the `Finish` button and wait for Android Studio to finish building the project.


### Add element-face-sdk and dependencies
The following steps require you to use Android Studio to open the Android project inside of the "platforms/android" directory of your Cordova App.
1. On the top menu bar, click `File -> Project Structure`.
1. Select your app module under `Modules` on the left pane, click on the `Dependencies` tab, and click on the `+` button at the bottom of the window. In the popup, click `Module Dependency` and select `:element-face-matching-sdk`. Click `Ok`.
1. Add `element-face-matching-sdk` module to your project by adding the following code to the `project.properties` file in the root directory of your project, but instead of "3" use the next sequential number after whatever is already defined in the file. The first two should be the CordovaLib, and the app itself.
    ```
    android.library.reference.3=element-face-matching-sdk
    ```    
1. Initiate a "Sync Project with Gradle Files"


### Register the Application Id (App Id) to Element and obtain the Encrypted Access Key (EAK)
The Element Face SDK requires the *Encrypted Access Key* (*EAK*) file. The *EAK* file carries encrypted information including the [Application Id (App Id)](https://developer.android.com/studio/build/application-id) of your Android app. Your registered *EAK* is available on the Element Dashboard, under `Account -> SDK`. Here is how you get a new *EAK* file:
1. On the same page of where you download the SDK file, fill in the `App Id` field with your `application id`. You can find your `application id` in your module-level `build.gradle` file. Leave other fields unchanged and click `Create EAK`.
1. You new EAK will be listed on the page. Hover your mouse on the EAK you want to download and a little download icon will appear next to your `app id`. Click it, name the file `element.eak` and save it to the desktop of your computer.

![dashboard-create-eak](https://github.com/Element1/element-android-examples/raw/master/element-cordova-face-matching-example/images/eakCreation.jpg "create-eak")


### Include the EAK in the application
1. Create a resources directory at `[project dir]/app/src/main/resources`.
1. Copy the `element.eak` file into the `resources` directory.
![resources](https://github.com/Element1/element-android-examples/raw/master/element-cordova-face-matching-example/images/resources.jpg "resources")


## Using the Element Face SDK APIs
### Initialize the Element Face Matching SDK
1. Installing the Face Matching SDK Plugin copied the `ElementFaceMatchingSDK` class into your project. This is the Java interface into the Face Matching SDK.
1. The Plugin also brings in "element.js". This is the Javascript interface used by your app code. All functions are called via the "element" object as such; `element.create()`
1. Please refer to `element.js` interface for latest function signature and supported operations. Use of these interfaces is demostrated in this app, specifically in [index.js](https://github.com/Element1/element-android-examples/raw/master/element-cordova-face-matching-example/www/js/index.js)
1. To have a complete demo, you must also replace the contents of www folder in Cordova root which is where the non-Android app code lives. 

### Ask for user permissions
The Element Face SDK Plugin manages all required permissions. They are CAMERA, ACCESS_FINE_LOCATION, ACCESS_COARSE_LOCATION.

### Questions?
If you have questions, please contact devsupport@discoverelement.com.
